var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,r=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&o(e,l,a[l]);if(s)for(var l of s(a))n.call(a,l)&&o(e,l,a[l]);return e},c=(e,s)=>a(e,l(s));import{d as i,s as u,x as d,m,g as p,e as g,f as v,H as f,I as b,t as k,E as h,h as y,r as w,b as _,A as q,p as V,c as S,w as j}from"./vendor.3edfc556.js";import{q as I}from"./qrcode.vue.esm.5b5c68be.js";import{a as C,_ as F}from"./index.1658c120.js";import{g as U,p as x}from"./index.d785fcaa.js";var O=i({components:{qrcodeVue:I},setup(){const e=u({type:"",bind:{wx:!1,qq:!1},qrcode:"",token:"",qrScanVisible:!1,checkTokenIntval:-1,message:""}),a=a=>(e=>C.get(`/auth/mini/qrcode/${e}`))(a).then((a=>{const{data:l}=a;return e.qrcode=l.img||l.url,e.token=l.token,e.message="请扫描小程序码",Promise.resolve()})),l=()=>{var a;(a=e.token,C.get("/auth/mini/binding",{params:{token:a}})).then((a=>{const{data:l}=a;console.log(l),e.message="绑定成功！"}))},s=t=>{console.log(encodeURIComponent(t)),(e=>C.get("/auth/mini/login/check",{params:{token:e}}))(t).then((t=>{const{data:n}=t;switch(console.log(n),0!==n.result&&3!==n.result&&clearInterval(e.checkTokenIntval),n.result){case-2:case-1:a(e.type).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}));break;case 0:console.log("等待授权");break;case 1:e.token="",e.message="授权被拒绝";break;case 2:e.message="授权成功！正在绑定...",l();break;case 3:e.message="已扫描，请进行授权操作"}}))};return c(r({},d(e)),{scanQRCode:l=>{e.qrScanVisible=!0,e.type=l,e.message="正在获取小程序码",a(l).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}))},cancelScan:()=>{e.qrScanVisible=!1,e.qrcode="",clearInterval(e.checkTokenIntval)},refreshQRCodeAction:()=>{e.message="正在刷新小程序码",clearInterval(e.checkTokenIntval),a(e.type).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}))}})}});const P={key:0},R={class:"dialog-footer"},E=h("刷新"),A=h("取消");O.render=function(e,a,l,s,t,n){const o=m("el-col"),r=m("el-row"),c=m("qrcode-vue"),i=m("el-button"),u=m("el-dialog");return p(),g("div",null,[v(r,null,{default:f((()=>[v(o,{span:12},{default:f((()=>[v("i",{class:"ic ic-weixindenglu login-icon",style:{color:e.bind.wx?"#1db308":"gray"},onClick:a[1]||(a[1]=a=>e.scanQRCode("WX"))},null,4)])),_:1}),v(o,{span:12},{default:f((()=>[v("i",{class:"ic ic-qqdenglu login-icon",style:{color:e.bind.qq?"#1277e3":"gray"},onClick:a[2]||(a[2]=a=>e.scanQRCode("QQ"))},null,4)])),_:1})])),_:1}),v(u,{modelValue:e.qrScanVisible,"onUpdate:modelValue":a[3]||(a[3]=a=>e.qrScanVisible=a),title:"请扫描小程序码"},{default:f((()=>[e.qrcode&&e.qrcode.length>0?(p(),g("div",P,["WX"===e.type?(p(),g("img",{key:0,height:"300",width:"300",src:e.qrcode},null,8,["src"])):(p(),g(c,{key:1,size:300,value:e.qrcode},null,8,["value"]))])):b("",!0),v("h2",null,k(e.message),1)])),footer:f((()=>[v("div",R,[v(i,{type:"primary",onClick:e.refreshQRCodeAction},{default:f((()=>[E])),_:1},8,["onClick"]),v(i,{onClick:e.cancelScan},{default:f((()=>[A])),_:1},8,["onClick"])])])),_:1},8,["modelValue"])])};var Q=i({name:"PersonalSetting",components:{MiniLogin:O},setup(){const e=y(),a=w("left"),l=w(),s=u({userSwitch:!1,sysSwitch:!0,taskSwitch:!0}),t=u({email:"",nickname:"",password:"",desc:"",mobile:"",avatar:"../../assets/avatar-default.jpg"}),n=w(),o=w(!1),i={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],nickname:{required:!0,message:"请输入昵称",trigger:["blur","change"]},desc:{required:!0,message:"请输入个人简介",trigger:["blur","change"]},mobile:{required:!0,validator:(e,a,l)=>{if(""===a)l(new Error("手机号码不可为空哦"));else{/^1[3-9]\d{9}$/.test(a)?l():l(new Error("请输入正确的手机号码"))}},trigger:["blur","change"]}};_((()=>{U().then((e=>{const{data:a}=e,{info:l}=a;t.email=l.email,t.nickname=l.nickname,l.avatar&&(t.avatar=l.avatar)}))}));return c(r({handleBack:()=>{e.go(-1)},tabPosition:a,settingFormRef:l,settingForm:t,submitForm:()=>{l.value.validate((async e=>{if(e){try{o.value=!0;const e=r({},t),a=await x(e);o.value=!1;const{result:l}=a.data;!0===l?q.ElMessage({type:"success",message:"更新成功"}):q.ElMessage({type:"error",message:"更新失败"})}catch(a){console.error(a)}return!0}return!1}))},resetForm:()=>{l.value.resetFields()},handleAvatarSuccess:(e,a)=>{n.value=URL.createObjectURL(a.raw)},beforeAvatarUpload:e=>{if(!/(gif|png|jpg|jpeg)$/i.test(e.type))return q.ElMessage({message:"上传头像图片只能是gif|png|jpg|jpeg 格式!",type:"warning"}),!1;const a=e.size/1024/1024<2;return a||q.ElMessage({type:"error",message:"上传头像图片大小不能超过 2MB!"}),a},rules:i,imageUrl:n},d(s)),{updateLoading:o})}});const T=j();V("data-v-74c81509");const M={class:"PersonalSetting"},L={class:"grid-content bg-purple-dark"},z={class:"card-header"},B=v("i",{class:"el-icon-arrow-left"},null,-1),$=h("返回 "),W=v("span",null,"个人设置",-1),X=v("div",null,null,-1),D=v("div",{class:"set-title"},[v("span",null,"基本设置")],-1),H={class:"set-info"},G={class:"form-info"},J=h("更新"),K=h("重置"),N={class:"avatar"},Y=v("div",{class:"preview"},[v("span",null,"头像"),v("img",{src:F})],-1),Z=v("i",{class:"el-icon-upload"},null,-1),ee=h("更换头像 "),ae=v("div",{class:"set-title"},[v("span",null,"安全设置")],-1),le=v("div",{class:"secure-item"},[v("div",{class:"secure-info"},[v("span",{class:"secure-key"},"绑定邮箱"),v("span",{class:"secure-value"},"已绑定邮箱：geek****@outlook.com")]),v("div",{class:"opera-btn"},[v("span",null,"修改")])],-1),se=v("div",{class:"set-title"},[v("span",null,"新消息通知")],-1),te={class:"secure-item"},ne=v("div",{class:"secure-info"},[v("span",{class:"secure-key"},"账户密码"),v("span",{class:"secure-value"},"用户信息将以系统内部渠道通知")],-1),oe={class:"secure-item"},re=v("div",{class:"secure-info"},[v("span",{class:"secure-key"},"系统消息"),v("span",{class:"secure-value"},"系统消息将以系统内部渠道通知")],-1),ce={class:"secure-item"},ie=v("div",{class:"secure-info"},[v("span",{class:"secure-key"},"代办任务"),v("span",{class:"secure-value"},"代办任务将以系统内部渠道通知")],-1),ue=v("div",{class:"set-title"},[v("span",null,"账号绑定")],-1),de={style:{"margin-top":"3rem"}};S();const me=T(((e,a,l,s,t,n)=>{const o=m("el-button"),r=m("el-input"),c=m("el-form-item"),i=m("el-form"),u=m("el-upload"),d=m("el-tab-pane"),f=m("el-switch"),b=m("el-tooltip"),k=m("mini-login"),h=m("el-tabs"),y=m("el-card"),w=m("el-col"),_=m("el-row");return p(),g("div",M,[v(_,null,{default:T((()=>[v(w,{offset:1,span:22},{default:T((()=>[v("div",L,[v(y,{class:"box-card"},{header:T((()=>[v("div",z,[v(o,{class:"button",type:"text",onClick:e.handleBack},{default:T((()=>[B,$])),_:1},8,["onClick"]),W,X])])),default:T((()=>[v(h,{"tab-position":e.tabPosition},{default:T((()=>[v(d,{label:"基本设置"},{default:T((()=>[D,v("div",H,[v("div",G,[v(i,{ref:"settingFormRef",model:e.settingForm,rules:e.rules,"label-width":"100px",class:"demo-ruleForm"},{default:T((()=>[v(c,{label:"昵称",prop:"nickname"},{default:T((()=>[v(r,{modelValue:e.settingForm.nickname,"onUpdate:modelValue":a[1]||(a[1]=a=>e.settingForm.nickname=a),placeholder:"请输入昵称",maxlength:"10"},null,8,["modelValue"])])),_:1}),v(c,{label:"邮箱",prop:"email"},{default:T((()=>[v(r,{modelValue:e.settingForm.email,"onUpdate:modelValue":a[2]||(a[2]=a=>e.settingForm.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),v(c,{label:"密码",prop:"password"},{default:T((()=>[v(r,{modelValue:e.settingForm.password,"onUpdate:modelValue":a[3]||(a[3]=a=>e.settingForm.password=a),placeholder:"密码"},null,8,["modelValue"])])),_:1}),v(c,null,{default:T((()=>[v(o,{type:"primary",loading:e.updateLoading,onClick:a[4]||(a[4]=a=>e.submitForm())},{default:T((()=>[J])),_:1},8,["loading"]),v(o,{onClick:a[5]||(a[5]=a=>e.resetForm())},{default:T((()=>[K])),_:1})])),_:1})])),_:1},8,["model","rules"])]),v("div",N,[Y,v(u,{class:"avatar-uploader",action:"https://jsonplaceholder.typicode.com/posts/","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:T((()=>[v(o,{style:{"margin-left":"10px"},size:"small",type:"success"},{default:T((()=>[Z,ee])),_:1})])),_:1},8,["on-success","before-upload"])])])])),_:1}),v(d,{label:"安全设置"},{default:T((()=>[ae,le])),_:1}),v(d,{label:"新消息通知"},{default:T((()=>[se,v("div",te,[ne,v(b,{content:"是否开启用户信息: ",placement:"top"},{default:T((()=>[v(f,{modelValue:e.userSwitch,"onUpdate:modelValue":a[6]||(a[6]=a=>e.userSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})]),v("div",oe,[re,v(b,{content:"是否开启系统消息: ",placement:"top"},{default:T((()=>[v(f,{modelValue:e.sysSwitch,"onUpdate:modelValue":a[7]||(a[7]=a=>e.sysSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})]),v("div",ce,[ie,v(b,{content:"是否开启代办任务消息: ",placement:"top"},{default:T((()=>[v(f,{modelValue:e.taskSwitch,"onUpdate:modelValue":a[8]||(a[8]=a=>e.taskSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})])])),_:1}),v(d,{label:"账号绑定"},{default:T((()=>[ue,v("div",de,[v(k)])])),_:1})])),_:1},8,["tab-position"])])),_:1})])])),_:1})])),_:1})])}));Q.render=me,Q.__scopeId="data-v-74c81509";export{Q as default};
