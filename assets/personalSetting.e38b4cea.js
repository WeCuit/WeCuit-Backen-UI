var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,r=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&o(e,l,a[l]);if(s)for(var l of s(a))n.call(a,l)&&o(e,l,a[l]);return e},c=(e,s)=>a(e,l(s));import{d as i,y as u,A as d,k as m,e as p,c as g,s as v,q as f,g as k,O as b,m as h,K as y,v as w,I as _,h as q,r as V,b as S,E as j,p as I,f as C}from"./vendor.15aec843.js";import{q as F}from"./qrcode.vue.esm.082a05a7.js";import{r as U,_ as x}from"./index.d603c67d.js";import{g as O,p as P}from"./index.d01d48d2.js";import"./request.aad8ae22.js";var R=i({components:{qrcodeVue:F},setup(){const e=u({type:"",bind:{wx:!1,qq:!1},qrcode:"",token:"",qrScanVisible:!1,checkTokenIntval:-1,message:""}),a=a=>(e=>U.get(`/auth/mini/qrcode/${e}`))(a).then((a=>{const{data:l}=a;return e.qrcode=l.img||l.url,e.token=l.token,e.message="请扫描小程序码",Promise.resolve()})),l=()=>{var a;(a=e.token,U.get("/auth/mini/binding",{params:{token:a}})).then((a=>{const{data:l}=a;console.log(l),e.message="绑定成功！"}))},s=t=>{console.log(encodeURIComponent(t)),(e=>U.get("/auth/mini/login/check",{params:{token:e}}))(t).then((t=>{const{data:n}=t;switch(console.log(n),0!==n.result&&3!==n.result&&clearInterval(e.checkTokenIntval),n.result){case-2:case-1:a(e.type).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}));break;case 0:console.log("等待授权");break;case 1:e.token="",e.message="授权被拒绝";break;case 2:e.message="授权成功！正在绑定...",l();break;case 3:e.message="已扫描，请进行授权操作"}}))};return c(r({},d(e)),{scanQRCode:l=>{e.qrScanVisible=!0,e.type=l,e.message="正在获取小程序码",a(l).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}))},cancelScan:()=>{e.qrScanVisible=!1,e.qrcode="",clearInterval(e.checkTokenIntval)},refreshQRCodeAction:()=>{e.message="正在刷新小程序码",clearInterval(e.checkTokenIntval),a(e.type).then((()=>{e.checkTokenIntval=setInterval(s,5e3,e.token)}))}})}});const E={key:0},A=["src"],Q={class:"dialog-footer"},T=_("刷新"),M=_("取消");R.render=function(e,a,l,s,t,n){const o=m("el-col"),r=m("el-row"),c=m("qrcode-vue"),i=m("el-button"),u=m("el-dialog");return p(),g("div",null,[v(r,null,{default:f((()=>[v(o,{span:12},{default:f((()=>[k("i",{class:"ic ic-weixindenglu login-icon",style:b({color:e.bind.wx?"#1db308":"gray"}),onClick:a[0]||(a[0]=a=>e.scanQRCode("WX"))},null,4)])),_:1}),v(o,{span:12},{default:f((()=>[k("i",{class:"ic ic-qqdenglu login-icon",style:b({color:e.bind.qq?"#1277e3":"gray"}),onClick:a[1]||(a[1]=a=>e.scanQRCode("QQ"))},null,4)])),_:1})])),_:1}),v(u,{modelValue:e.qrScanVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.qrScanVisible=a),title:"请扫描小程序码"},{default:f((()=>[e.qrcode&&e.qrcode.length>0?(p(),g("div",E,["WX"===e.type?(p(),g("img",{key:0,height:"300",width:"300",src:e.qrcode},null,8,A)):(p(),h(c,{key:1,size:300,value:e.qrcode},null,8,["value"]))])):y("",!0),k("h2",null,w(e.message),1)])),footer:f((()=>[k("div",Q,[v(i,{type:"primary",onClick:e.refreshQRCodeAction},{default:f((()=>[T])),_:1},8,["onClick"]),v(i,{onClick:e.cancelScan},{default:f((()=>[M])),_:1},8,["onClick"])])])),_:1},8,["modelValue"])])};var L=i({name:"PersonalSetting",components:{MiniLogin:R},setup(){const e=q(),a=V("left"),l=V(),s=u({userSwitch:!1,sysSwitch:!0,taskSwitch:!0}),t=u({email:"",nickname:"",password:"",desc:"",mobile:"",avatar:"../../assets/avatar-default.jpg"}),n=V(),o=V(!1),i={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],nickname:{required:!0,message:"请输入昵称",trigger:["blur","change"]},desc:{required:!0,message:"请输入个人简介",trigger:["blur","change"]},mobile:{required:!0,validator:(e,a,l)=>{if(""===a)l(new Error("手机号码不可为空哦"));else{/^1[3-9]\d{9}$/.test(a)?l():l(new Error("请输入正确的手机号码"))}},trigger:["blur","change"]}};S((()=>{O().then((e=>{const{data:a}=e,{info:l}=a;t.email=l.email,t.nickname=l.nickname,l.avatar&&(t.avatar=l.avatar)}))}));return c(r({handleBack:()=>{e.go(-1)},tabPosition:a,settingFormRef:l,settingForm:t,submitForm:()=>{l.value.validate((async e=>{if(e){try{o.value=!0;const e=r({},t),a=await P(e);o.value=!1;const{result:l}=a.data;!0===l?j.ElMessage({type:"success",message:"更新成功"}):j.ElMessage({type:"error",message:"更新失败"})}catch(a){console.error(a)}return!0}return!1}))},resetForm:()=>{l.value.resetFields()},handleAvatarSuccess:(e,a)=>{n.value=URL.createObjectURL(a.raw)},beforeAvatarUpload:e=>{if(!/(gif|png|jpg|jpeg)$/i.test(e.type))return j.ElMessage({message:"上传头像图片只能是gif|png|jpg|jpeg 格式!",type:"warning"}),!1;const a=e.size/1024/1024<2;return a||j.ElMessage({type:"error",message:"上传头像图片大小不能超过 2MB!"}),a},rules:i,imageUrl:n},d(s)),{updateLoading:o})}});const z=e=>(I("data-v-74c81509"),e=e(),C(),e),B={class:"PersonalSetting"},$={class:"grid-content bg-purple-dark"},W={class:"card-header"},X=z((()=>k("i",{class:"el-icon-arrow-left"},null,-1))),D=_("返回 "),K=z((()=>k("span",null,"个人设置",-1))),G=z((()=>k("div",null,null,-1))),H=z((()=>k("div",{class:"set-title"},[k("span",null,"基本设置")],-1))),J={class:"set-info"},N={class:"form-info"},Y=_("更新"),Z=_("重置"),ee={class:"avatar"},ae=z((()=>k("div",{class:"preview"},[k("span",null,"头像"),k("img",{src:x})],-1))),le=z((()=>k("i",{class:"el-icon-upload"},null,-1))),se=_("更换头像 "),te=z((()=>k("div",{class:"set-title"},[k("span",null,"安全设置")],-1))),ne=z((()=>k("div",{class:"secure-item"},[k("div",{class:"secure-info"},[k("span",{class:"secure-key"},"绑定邮箱"),k("span",{class:"secure-value"},"已绑定邮箱：geek****@outlook.com")]),k("div",{class:"opera-btn"},[k("span",null,"修改")])],-1))),oe=z((()=>k("div",{class:"set-title"},[k("span",null,"新消息通知")],-1))),re={class:"secure-item"},ce=z((()=>k("div",{class:"secure-info"},[k("span",{class:"secure-key"},"账户密码"),k("span",{class:"secure-value"},"用户信息将以系统内部渠道通知")],-1))),ie={class:"secure-item"},ue=z((()=>k("div",{class:"secure-info"},[k("span",{class:"secure-key"},"系统消息"),k("span",{class:"secure-value"},"系统消息将以系统内部渠道通知")],-1))),de={class:"secure-item"},me=z((()=>k("div",{class:"secure-info"},[k("span",{class:"secure-key"},"代办任务"),k("span",{class:"secure-value"},"代办任务将以系统内部渠道通知")],-1))),pe=z((()=>k("div",{class:"set-title"},[k("span",null,"账号绑定")],-1))),ge={style:{"margin-top":"3rem"}};L.render=function(e,a,l,s,t,n){const o=m("el-button"),r=m("el-input"),c=m("el-form-item"),i=m("el-form"),u=m("el-upload"),d=m("el-tab-pane"),b=m("el-switch"),h=m("el-tooltip"),y=m("mini-login"),w=m("el-tabs"),_=m("el-card"),q=m("el-col"),V=m("el-row");return p(),g("div",B,[v(V,null,{default:f((()=>[v(q,{offset:1,span:22},{default:f((()=>[k("div",$,[v(_,{class:"box-card"},{header:f((()=>[k("div",W,[v(o,{class:"button",type:"text",onClick:e.handleBack},{default:f((()=>[X,D])),_:1},8,["onClick"]),K,G])])),default:f((()=>[v(w,{"tab-position":e.tabPosition},{default:f((()=>[v(d,{label:"基本设置"},{default:f((()=>[H,k("div",J,[k("div",N,[v(i,{ref:"settingFormRef",model:e.settingForm,rules:e.rules,"label-width":"100px",class:"demo-ruleForm"},{default:f((()=>[v(c,{label:"昵称",prop:"nickname"},{default:f((()=>[v(r,{modelValue:e.settingForm.nickname,"onUpdate:modelValue":a[0]||(a[0]=a=>e.settingForm.nickname=a),placeholder:"请输入昵称",maxlength:"10"},null,8,["modelValue"])])),_:1}),v(c,{label:"邮箱",prop:"email"},{default:f((()=>[v(r,{modelValue:e.settingForm.email,"onUpdate:modelValue":a[1]||(a[1]=a=>e.settingForm.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),v(c,{label:"密码",prop:"password"},{default:f((()=>[v(r,{modelValue:e.settingForm.password,"onUpdate:modelValue":a[2]||(a[2]=a=>e.settingForm.password=a),placeholder:"密码"},null,8,["modelValue"])])),_:1}),v(c,null,{default:f((()=>[v(o,{type:"primary",loading:e.updateLoading,onClick:a[3]||(a[3]=a=>e.submitForm())},{default:f((()=>[Y])),_:1},8,["loading"]),v(o,{onClick:a[4]||(a[4]=a=>e.resetForm())},{default:f((()=>[Z])),_:1})])),_:1})])),_:1},8,["model","rules"])]),k("div",ee,[ae,v(u,{class:"avatar-uploader",action:"https://jsonplaceholder.typicode.com/posts/","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:f((()=>[v(o,{style:{"margin-left":"10px"},size:"small",type:"success"},{default:f((()=>[le,se])),_:1})])),_:1},8,["on-success","before-upload"])])])])),_:1}),v(d,{label:"安全设置"},{default:f((()=>[te,ne])),_:1}),v(d,{label:"新消息通知"},{default:f((()=>[oe,k("div",re,[ce,v(h,{content:"是否开启用户信息: ",placement:"top"},{default:f((()=>[v(b,{modelValue:e.userSwitch,"onUpdate:modelValue":a[5]||(a[5]=a=>e.userSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})]),k("div",ie,[ue,v(h,{content:"是否开启系统消息: ",placement:"top"},{default:f((()=>[v(b,{modelValue:e.sysSwitch,"onUpdate:modelValue":a[6]||(a[6]=a=>e.sysSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})]),k("div",de,[me,v(h,{content:"是否开启代办任务消息: ",placement:"top"},{default:f((()=>[v(b,{modelValue:e.taskSwitch,"onUpdate:modelValue":a[7]||(a[7]=a=>e.taskSwitch=a),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})])])),_:1}),v(d,{label:"账号绑定"},{default:f((()=>[pe,k("div",ge,[v(y)])])),_:1})])),_:1},8,["tab-position"])])),_:1})])])),_:1})])),_:1})])},L.__scopeId="data-v-74c81509";export{L as default};
